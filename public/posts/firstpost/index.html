<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Building an Home Automation Kubernetes Infrastructure with Home Assistant | Nicola Tomassoni</title>
<meta name=keywords content="kubernetes,k3s,home-assistant,esphome,pihole,wireguard,gitops,argocd,homelab,home-automation,self-hosted"><meta name=description content="A comprehensive guide to setting up a home infrastructure using Kubernetes (K3s), Kustomize, and ArgoCD for GitOps, featuring Home Assistant, ESPHome, Pi-hole, and WireGuard VPN."><meta name=author content="Nicola Tomassoni"><link rel=canonical href=https://nicolatomassoni.it/posts/firstpost/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://nicolatomassoni.it/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://nicolatomassoni.it/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://nicolatomassoni.it/favicon-32x32.png><link rel=apple-touch-icon href=https://nicolatomassoni.it/apple-touch-icon.png><link rel=mask-icon href=https://nicolatomassoni.it/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://nicolatomassoni.it/posts/firstpost/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://nicolatomassoni.it/posts/firstpost/"><meta property="og:site_name" content="Nicola Tomassoni"><meta property="og:title" content="Building an Home Automation Kubernetes Infrastructure with Home Assistant"><meta property="og:description" content="A comprehensive guide to setting up a home infrastructure using Kubernetes (K3s), Kustomize, and ArgoCD for GitOps, featuring Home Assistant, ESPHome, Pi-hole, and WireGuard VPN."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-02-28T00:00:00+00:00"><meta property="article:modified_time" content="2025-02-28T00:00:00+00:00"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="K3s"><meta property="article:tag" content="Home-Assistant"><meta property="article:tag" content="Esphome"><meta property="article:tag" content="Pihole"><meta property="article:tag" content="Wireguard"><meta property="og:image" content="https://nicolatomassoni.it/io.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nicolatomassoni.it/io.webp"><meta name=twitter:title content="Building an Home Automation Kubernetes Infrastructure with Home Assistant"><meta name=twitter:description content="A comprehensive guide to setting up a home infrastructure using Kubernetes (K3s), Kustomize, and ArgoCD for GitOps, featuring Home Assistant, ESPHome, Pi-hole, and WireGuard VPN."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://nicolatomassoni.it/posts/"},{"@type":"ListItem","position":2,"name":"Building an Home Automation Kubernetes Infrastructure with Home Assistant","item":"https://nicolatomassoni.it/posts/firstpost/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Building an Home Automation Kubernetes Infrastructure with Home Assistant","name":"Building an Home Automation Kubernetes Infrastructure with Home Assistant","description":"A comprehensive guide to setting up a home infrastructure using Kubernetes (K3s), Kustomize, and ArgoCD for GitOps, featuring Home Assistant, ESPHome, Pi-hole, and WireGuard VPN.","keywords":["kubernetes","k3s","home-assistant","esphome","pihole","wireguard","gitops","argocd","homelab","home-automation","self-hosted"],"articleBody":"Kubernetes Home Infrastructure ⚠ NOTE: This is a Work in progress\nGitHUB repository\nThis repository contains the Kubernetes configuration for a home infrastructure setup using K3s, Kustomize, and ArgoCD for GitOps. The setup includes various services like Home Assistant, ESPHome, Pi-hole, WireGuard VPN, and web services.\nArchitecture Overview The infrastructure is built on K3s with the following components:\nGitOps: ArgoCD for continuous deployment from Git Service Discovery: CoreDNS with custom host entries Certificate Management: cert-manager with Let’s Encrypt Ingress: NGINX Ingress Controller Storage: Local-path-provisioner for persistent storage Namespaces: domotica: Home automation services http: Web services pihole: Network-wide ad blocking wireguard: VPN services restic: Backups argocd: GitOps deployment cert-manager: Certificate management Services Service Description Access Home Assistant Home automation platform https://my.domain.tld/ ESPHome ESP32/ESP8266 management https://my.domain.tld/esphome/ Pi-hole Network-wide ad blocking https://my.domain.tld/pihole/ WireGuard VPN server with Web UI https://:51821/ Personal Website Static website https://my.domain.tld/ SC Mapping Custom NodeJS application https://second.domain.tld/ ArgoCD GitOps UI https://argocd.my.domain.tld/ Backrest Restic backup UI http://:9898/ Directory Structure k8s/ ├── argocd/ # ArgoCD configuration ├── base/ # Base configurations │ ├── backrest/ # Backup management │ ├── domotica/ # Home automation │ │ ├── esphome/ # ESP device management │ │ └── homeassistant/# Home Assistant │ ├── http/ # Web services │ │ ├── personalsite/ # Personal website │ ├── pihole/ # Network ad blocking │ └── wireguard/ # VPN server ├── certmanager/ # Certificate management ├── coredns/ # DNS configuration └── overlays/ # Environment-specific overlays ├── development/ # Development environment └── production/ # Production environment Prerequisites Linux server with at least 4GB RAM and 2 CPU cores K3s installed Domain name(s) with proper DNS configuration Port forwarding for: 80/443 (HTTP/HTTPS) 51820/UDP (WireGuard) 51821/TCP (WireGuard Web UI) Installation Guide 1. Install K3s curl -sfL https://get.k3s.io | sh - For a minimal installation without Traefik (since we’ll use NGINX Ingress):\ncurl -sfL https://get.k3s.io | INSTALL_K3S_EXEC=\"--disable=traefik\" sh - 2. Install NGINX Ingress Controller kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.8.2/deploy/static/provider/cloud/deploy.yaml 3. Install cert-manager helm repo add jetstack https://charts.jetstack.io helm repo update helm install cert-manager jetstack/cert-manager \\ --namespace cert-manager \\ --create-namespace \\ --version v1.12.0 \\ --set installCRDs=true Apply the ClusterIssuer configuration:\nkubectl apply -f k8s/certmanager/cluster-issuer.yaml 4. Create Required Namespaces kubectl create namespace domotica kubectl create namespace http kubectl create namespace pihole kubectl create namespace wireguard kubectl create namespace restic 5. Create Secrets Create the required secrets (see SECRETS.md for templates):\n# For WireGuard kubectl apply -f wireguard-secrets.yaml # For Pi-hole kubectl apply -f pihole-secret.yaml 6. Apply Storage Configuration kubectl apply -f k8s/local-path-config.yaml 7. Install ArgoCD (Optional, for GitOps) kubectl create namespace argocd kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml kubectl apply -f k8s/argocd/configmap.yml kubectl apply -f k8s/argocd/ingress.yml # Get the initial admin password kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=\"{.data.password}\" | base64 -d 8. Deploy the Services Using kubectl and kustomize:\n# Deploy all services kubectl apply -k k8s/base/ # Or deploy individual services kubectl apply -k k8s/base/domotica/ kubectl apply -k k8s/base/http/ kubectl apply -k k8s/base/pihole/ kubectl apply -k k8s/base/wireguard/ Or using ArgoCD:\nCreate an application in ArgoCD pointing to your Git repository Set the path to k8s/base Set the destination to your cluster Enable auto-sync Service Configuration Home Assistant and ESPHome The configuration files are stored in persistent volumes:\nHome Assistant: /mnt/storage/ha-config-pvc ESPHome: /mnt/storage/esphome-config-pvc Pi-hole The Pi-hole configuration files are stored in:\n/mnt/storage/pihole-etc-pvc /mnt/storage/dnsmasq-etc-pvc WireGuard The WireGuard configuration files are stored in:\n/mnt/storage/wireguard-data-pvc CoreDNS To add local DNS entries, edit the ConfigMap:\nkubectl edit configmap coredns -n kube-system Or apply the configuration from the repository:\nkubectl apply -k k8s/coredns/ Environment-Specific Configurations The repository includes overlay directories for development and production environments:\n# For development kubectl apply -k k8s/overlays/development/ # For production kubectl apply -k k8s/overlays/production/ Accessing Services Local Network Services with LoadBalancer type (Home Assistant, ESPHome, Pi-hole, WireGuard) can be accessed directly via the node IP:\nHome Assistant: http://:8123 ESPHome: http://:6052 Pi-hole: http://:8000 WireGuard Web UI: http://:51821 External Access (via Ingress) All services configured with Ingress can be accessed via their respective domain names:\nHome Assistant: https://my.domain.tld/ ESPHome: https://my.domain.tld/esphome/ Pi-hole: https://my.domain.tld/pihole/ Personal Website: https://my.domain.tld/ and https://www.my.domain.tld/ SC Mapping: https://second.domain.tld/ ArgoCD: https://argocd.my.domain.tld/ Monitoring and Troubleshooting Check Ingress Status kubectl get ingress --all-namespaces kubectl describe ingress -n Check Certificates kubectl get certificate --all-namespaces kubectl describe certificate -n Check Running Pods kubectl get pods --all-namespaces kubectl describe pod -n View Logs kubectl logs -n Backup and Restore For backup management, the setup includes Backrest, a web UI for Restic backups.\nkubectl apply -k k8s/base/backrest/ Access the Backrest UI at http://:9898\nStorage Management For detailed information about persistent storage configuration, volume management, backups, and troubleshooting, see the Storage Management Guide.\nSecurity Considerations Credentials are stored in Kubernetes secrets HTTPS is enforced via cert-manager and Let’s Encrypt WireGuard provides secure remote access to the network Resources are isolated using namespaces Resource Requirements The entire setup requires approximately:\n2-4 CPU cores 4-8 GB RAM 50+ GB storage space Individual service requirements are defined in the deployment manifests with resource limits.\nReferences K3s: https://k3s.io/ ArgoCD: https://argo-cd.readthedocs.io/ Kustomize: https://kustomize.io/ Home Assistant: https://www.home-assistant.io/ ESPHome: https://esphome.io/ Pi-hole: https://pi-hole.net/ WireGuard: https://www.wireguard.com/ Cert-Manager: https://cert-manager.io/ ","wordCount":"835","inLanguage":"en","image":"https://nicolatomassoni.it/io.webp","datePublished":"2025-02-28T00:00:00Z","dateModified":"2025-02-28T00:00:00Z","author":[{"@type":"Person","name":"Nicola Tomassoni"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://nicolatomassoni.it/posts/firstpost/"},"publisher":{"@type":"Organization","name":"Nicola Tomassoni","logo":{"@type":"ImageObject","url":"https://nicolatomassoni.it/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://nicolatomassoni.it/ accesskey=h title="Nicola Tomassoni (Alt + H)">Nicola Tomassoni</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://nicolatomassoni.it/posts/ title=posts><span>posts</span></a></li><li><a href=https://nicolatomassoni.it/cv/ title=CV><span>CV</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://nicolatomassoni.it/>Home</a>&nbsp;»&nbsp;<a href=https://nicolatomassoni.it/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Building an Home Automation Kubernetes Infrastructure with Home Assistant</h1><div class=post-description>A comprehensive guide to setting up a home infrastructure using Kubernetes (K3s), Kustomize, and ArgoCD for GitOps, featuring Home Assistant, ESPHome, Pi-hole, and WireGuard VPN.</div><div class=post-meta><span title='2025-02-28 00:00:00 +0000 UTC'>28 Feb 2025</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;835 words&nbsp;·&nbsp;Nicola Tomassoni</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#architecture-overview>Architecture Overview</a></li><li><a href=#services>Services</a></li><li><a href=#directory-structure>Directory Structure</a></li><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#installation-guide>Installation Guide</a><ul><li><a href=#1-install-k3s>1. Install K3s</a></li><li><a href=#2-install-nginx-ingress-controller>2. Install NGINX Ingress Controller</a></li><li><a href=#3-install-cert-manager>3. Install cert-manager</a></li><li><a href=#4-create-required-namespaces>4. Create Required Namespaces</a></li><li><a href=#5-create-secrets>5. Create Secrets</a></li><li><a href=#6-apply-storage-configuration>6. Apply Storage Configuration</a></li><li><a href=#7-install-argocd-optional-for-gitops>7. Install ArgoCD (Optional, for GitOps)</a></li><li><a href=#8-deploy-the-services>8. Deploy the Services</a></li></ul></li><li><a href=#service-configuration>Service Configuration</a><ul><li><a href=#home-assistant-and-esphome>Home Assistant and ESPHome</a></li><li><a href=#pi-hole>Pi-hole</a></li><li><a href=#wireguard>WireGuard</a></li><li><a href=#coredns>CoreDNS</a></li></ul></li><li><a href=#environment-specific-configurations>Environment-Specific Configurations</a></li><li><a href=#accessing-services>Accessing Services</a><ul><li><a href=#local-network>Local Network</a></li><li><a href=#external-access-via-ingress>External Access (via Ingress)</a></li></ul></li><li><a href=#monitoring-and-troubleshooting>Monitoring and Troubleshooting</a><ul><li><a href=#check-ingress-status>Check Ingress Status</a></li><li><a href=#check-certificates>Check Certificates</a></li><li><a href=#check-running-pods>Check Running Pods</a></li><li><a href=#view-logs>View Logs</a></li></ul></li><li><a href=#backup-and-restore>Backup and Restore</a></li><li><a href=#storage-management>Storage Management</a></li><li><a href=#security-considerations>Security Considerations</a></li><li><a href=#resource-requirements>Resource Requirements</a></li><li><a href=#references>References</a></li></ul></nav></div></details></div><div class=post-content><h1 id=kubernetes-home-infrastructure>Kubernetes Home Infrastructure<a hidden class=anchor aria-hidden=true href=#kubernetes-home-infrastructure>#</a></h1><p><strong>⚠ NOTE:</strong> <em>This is a Work in progress</em></p><p><a href=https://github.com/nonzod/homeassistant-k3s>GitHUB repository</a></p><p>This repository contains the Kubernetes configuration for a home infrastructure setup using K3s, Kustomize, and ArgoCD for GitOps. The setup includes various services like Home Assistant, ESPHome, Pi-hole, WireGuard VPN, and web services.</p><h2 id=architecture-overview>Architecture Overview<a hidden class=anchor aria-hidden=true href=#architecture-overview>#</a></h2><p>The infrastructure is built on K3s with the following components:</p><ul><li><strong>GitOps</strong>: ArgoCD for continuous deployment from Git</li><li><strong>Service Discovery</strong>: CoreDNS with custom host entries</li><li><strong>Certificate Management</strong>: cert-manager with Let&rsquo;s Encrypt</li><li><strong>Ingress</strong>: NGINX Ingress Controller</li><li><strong>Storage</strong>: Local-path-provisioner for persistent storage</li><li><strong>Namespaces</strong>:<ul><li><code>domotica</code>: Home automation services</li><li><code>http</code>: Web services</li><li><code>pihole</code>: Network-wide ad blocking</li><li><code>wireguard</code>: VPN services</li><li><code>restic</code>: Backups</li><li><code>argocd</code>: GitOps deployment</li><li><code>cert-manager</code>: Certificate management</li></ul></li></ul><h2 id=services>Services<a hidden class=anchor aria-hidden=true href=#services>#</a></h2><table><thead><tr><th>Service</th><th>Description</th><th>Access</th></tr></thead><tbody><tr><td><strong>Home Assistant</strong></td><td>Home automation platform</td><td><code>https://my.domain.tld/</code></td></tr><tr><td><strong>ESPHome</strong></td><td>ESP32/ESP8266 management</td><td><code>https://my.domain.tld/esphome/</code></td></tr><tr><td><strong>Pi-hole</strong></td><td>Network-wide ad blocking</td><td><code>https://my.domain.tld/pihole/</code></td></tr><tr><td><strong>WireGuard</strong></td><td>VPN server with Web UI</td><td><code>https://&lt;server-ip>:51821/</code></td></tr><tr><td><strong>Personal Website</strong></td><td>Static website</td><td><code>https://my.domain.tld/</code></td></tr><tr><td><strong>SC Mapping</strong></td><td>Custom NodeJS application</td><td><code>https://second.domain.tld/</code></td></tr><tr><td><strong>ArgoCD</strong></td><td>GitOps UI</td><td><code>https://argocd.my.domain.tld/</code></td></tr><tr><td><strong>Backrest</strong></td><td>Restic backup UI</td><td><code>http://&lt;server-ip>:9898/</code></td></tr></tbody></table><h2 id=directory-structure>Directory Structure<a hidden class=anchor aria-hidden=true href=#directory-structure>#</a></h2><pre tabindex=0><code>k8s/
├── argocd/               # ArgoCD configuration
├── base/                 # Base configurations
│   ├── backrest/         # Backup management
│   ├── domotica/         # Home automation
│   │   ├── esphome/      # ESP device management
│   │   └── homeassistant/# Home Assistant
│   ├── http/             # Web services
│   │   ├── personalsite/ # Personal website
│   ├── pihole/           # Network ad blocking
│   └── wireguard/        # VPN server
├── certmanager/          # Certificate management
├── coredns/              # DNS configuration
└── overlays/             # Environment-specific overlays
    ├── development/      # Development environment
    └── production/       # Production environment
</code></pre><h2 id=prerequisites>Prerequisites<a hidden class=anchor aria-hidden=true href=#prerequisites>#</a></h2><ul><li>Linux server with at least 4GB RAM and 2 CPU cores</li><li>K3s installed</li><li>Domain name(s) with proper DNS configuration</li><li>Port forwarding for:</li><li>80/443 (HTTP/HTTPS)</li><li>51820/UDP (WireGuard)</li><li>51821/TCP (WireGuard Web UI)</li></ul><h2 id=installation-guide>Installation Guide<a hidden class=anchor aria-hidden=true href=#installation-guide>#</a></h2><h3 id=1-install-k3s>1. Install K3s<a hidden class=anchor aria-hidden=true href=#1-install-k3s>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sfL https://get.k3s.io <span class=p>|</span> sh -
</span></span></code></pre></div><p>For a minimal installation without Traefik (since we&rsquo;ll use NGINX Ingress):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sfL https://get.k3s.io <span class=p>|</span> <span class=nv>INSTALL_K3S_EXEC</span><span class=o>=</span><span class=s2>&#34;--disable=traefik&#34;</span> sh -
</span></span></code></pre></div><h3 id=2-install-nginx-ingress-controller>2. Install NGINX Ingress Controller<a hidden class=anchor aria-hidden=true href=#2-install-nginx-ingress-controller>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.8.2/deploy/static/provider/cloud/deploy.yaml
</span></span></code></pre></div><h3 id=3-install-cert-manager>3. Install cert-manager<a hidden class=anchor aria-hidden=true href=#3-install-cert-manager>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add jetstack https://charts.jetstack.io
</span></span><span class=line><span class=cl>helm repo update
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>helm install cert-manager jetstack/cert-manager <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --namespace cert-manager <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --create-namespace <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --version v1.12.0 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set <span class=nv>installCRDs</span><span class=o>=</span><span class=nb>true</span>
</span></span></code></pre></div><p>Apply the ClusterIssuer configuration:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f k8s/certmanager/cluster-issuer.yaml
</span></span></code></pre></div><h3 id=4-create-required-namespaces>4. Create Required Namespaces<a hidden class=anchor aria-hidden=true href=#4-create-required-namespaces>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create namespace domotica
</span></span><span class=line><span class=cl>kubectl create namespace http
</span></span><span class=line><span class=cl>kubectl create namespace pihole
</span></span><span class=line><span class=cl>kubectl create namespace wireguard
</span></span><span class=line><span class=cl>kubectl create namespace restic
</span></span></code></pre></div><h3 id=5-create-secrets>5. Create Secrets<a hidden class=anchor aria-hidden=true href=#5-create-secrets>#</a></h3><p>Create the required secrets (see SECRETS.md for templates):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># For WireGuard</span>
</span></span><span class=line><span class=cl>kubectl apply -f wireguard-secrets.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># For Pi-hole</span>
</span></span><span class=line><span class=cl>kubectl apply -f pihole-secret.yaml
</span></span></code></pre></div><h3 id=6-apply-storage-configuration>6. Apply Storage Configuration<a hidden class=anchor aria-hidden=true href=#6-apply-storage-configuration>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f k8s/local-path-config.yaml
</span></span></code></pre></div><h3 id=7-install-argocd-optional-for-gitops>7. Install ArgoCD (Optional, for GitOps)<a hidden class=anchor aria-hidden=true href=#7-install-argocd-optional-for-gitops>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create namespace argocd
</span></span><span class=line><span class=cl>kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
</span></span><span class=line><span class=cl>kubectl apply -f k8s/argocd/configmap.yml
</span></span><span class=line><span class=cl>kubectl apply -f k8s/argocd/ingress.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Get the initial admin password</span>
</span></span><span class=line><span class=cl>kubectl -n argocd get secret argocd-initial-admin-secret -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s2>&#34;{.data.password}&#34;</span> <span class=p>|</span> base64 -d
</span></span></code></pre></div><h3 id=8-deploy-the-services>8. Deploy the Services<a hidden class=anchor aria-hidden=true href=#8-deploy-the-services>#</a></h3><p>Using kubectl and kustomize:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Deploy all services</span>
</span></span><span class=line><span class=cl>kubectl apply -k k8s/base/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Or deploy individual services</span>
</span></span><span class=line><span class=cl>kubectl apply -k k8s/base/domotica/
</span></span><span class=line><span class=cl>kubectl apply -k k8s/base/http/
</span></span><span class=line><span class=cl>kubectl apply -k k8s/base/pihole/
</span></span><span class=line><span class=cl>kubectl apply -k k8s/base/wireguard/
</span></span></code></pre></div><p>Or using ArgoCD:</p><ol><li>Create an application in ArgoCD pointing to your Git repository</li><li>Set the path to <code>k8s/base</code></li><li>Set the destination to your cluster</li><li>Enable auto-sync</li></ol><h2 id=service-configuration>Service Configuration<a hidden class=anchor aria-hidden=true href=#service-configuration>#</a></h2><h3 id=home-assistant-and-esphome>Home Assistant and ESPHome<a hidden class=anchor aria-hidden=true href=#home-assistant-and-esphome>#</a></h3><p>The configuration files are stored in persistent volumes:</p><ul><li>Home Assistant: <code>/mnt/storage/ha-config-pvc</code></li><li>ESPHome: <code>/mnt/storage/esphome-config-pvc</code></li></ul><h3 id=pi-hole>Pi-hole<a hidden class=anchor aria-hidden=true href=#pi-hole>#</a></h3><p>The Pi-hole configuration files are stored in:</p><ul><li><code>/mnt/storage/pihole-etc-pvc</code></li><li><code>/mnt/storage/dnsmasq-etc-pvc</code></li></ul><h3 id=wireguard>WireGuard<a hidden class=anchor aria-hidden=true href=#wireguard>#</a></h3><p>The WireGuard configuration files are stored in:</p><ul><li><code>/mnt/storage/wireguard-data-pvc</code></li></ul><h3 id=coredns>CoreDNS<a hidden class=anchor aria-hidden=true href=#coredns>#</a></h3><p>To add local DNS entries, edit the ConfigMap:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl edit configmap coredns -n kube-system
</span></span></code></pre></div><p>Or apply the configuration from the repository:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -k k8s/coredns/
</span></span></code></pre></div><h2 id=environment-specific-configurations>Environment-Specific Configurations<a hidden class=anchor aria-hidden=true href=#environment-specific-configurations>#</a></h2><p>The repository includes overlay directories for development and production environments:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># For development</span>
</span></span><span class=line><span class=cl>kubectl apply -k k8s/overlays/development/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># For production</span>
</span></span><span class=line><span class=cl>kubectl apply -k k8s/overlays/production/
</span></span></code></pre></div><h2 id=accessing-services>Accessing Services<a hidden class=anchor aria-hidden=true href=#accessing-services>#</a></h2><h3 id=local-network>Local Network<a hidden class=anchor aria-hidden=true href=#local-network>#</a></h3><p>Services with LoadBalancer type (Home Assistant, ESPHome, Pi-hole, WireGuard) can be accessed directly via the node IP:</p><ul><li>Home Assistant: <code>http://&lt;node-ip>:8123</code></li><li>ESPHome: <code>http://&lt;node-ip>:6052</code></li><li>Pi-hole: <code>http://&lt;node-ip>:8000</code></li><li>WireGuard Web UI: <code>http://&lt;node-ip>:51821</code></li></ul><h3 id=external-access-via-ingress>External Access (via Ingress)<a hidden class=anchor aria-hidden=true href=#external-access-via-ingress>#</a></h3><p>All services configured with Ingress can be accessed via their respective domain names:</p><ul><li>Home Assistant: <code>https://my.domain.tld/</code></li><li>ESPHome: <code>https://my.domain.tld/esphome/</code></li><li>Pi-hole: <code>https://my.domain.tld/pihole/</code></li><li>Personal Website: <code>https://my.domain.tld/</code> and <code>https://www.my.domain.tld/</code></li><li>SC Mapping: <code>https://second.domain.tld/</code></li><li>ArgoCD: <code>https://argocd.my.domain.tld/</code></li></ul><h2 id=monitoring-and-troubleshooting>Monitoring and Troubleshooting<a hidden class=anchor aria-hidden=true href=#monitoring-and-troubleshooting>#</a></h2><h3 id=check-ingress-status>Check Ingress Status<a hidden class=anchor aria-hidden=true href=#check-ingress-status>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get ingress --all-namespaces
</span></span><span class=line><span class=cl>kubectl describe ingress &lt;ingress-name&gt; -n &lt;namespace&gt;
</span></span></code></pre></div><h3 id=check-certificates>Check Certificates<a hidden class=anchor aria-hidden=true href=#check-certificates>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get certificate --all-namespaces
</span></span><span class=line><span class=cl>kubectl describe certificate &lt;cert-name&gt; -n &lt;namespace&gt;
</span></span></code></pre></div><h3 id=check-running-pods>Check Running Pods<a hidden class=anchor aria-hidden=true href=#check-running-pods>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods --all-namespaces
</span></span><span class=line><span class=cl>kubectl describe pod &lt;pod-name&gt; -n &lt;namespace&gt;
</span></span></code></pre></div><h3 id=view-logs>View Logs<a hidden class=anchor aria-hidden=true href=#view-logs>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs &lt;pod-name&gt; -n &lt;namespace&gt;
</span></span></code></pre></div><h2 id=backup-and-restore>Backup and Restore<a hidden class=anchor aria-hidden=true href=#backup-and-restore>#</a></h2><p>For backup management, the setup includes Backrest, a web UI for Restic backups.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -k k8s/base/backrest/
</span></span></code></pre></div><p>Access the Backrest UI at <code>http://&lt;node-ip>:9898</code></p><h2 id=storage-management>Storage Management<a hidden class=anchor aria-hidden=true href=#storage-management>#</a></h2><p>For detailed information about persistent storage configuration, volume management, backups, and troubleshooting, see the <a href=STORAGE.md>Storage Management Guide</a>.</p><h2 id=security-considerations>Security Considerations<a hidden class=anchor aria-hidden=true href=#security-considerations>#</a></h2><ul><li>Credentials are stored in Kubernetes secrets</li><li>HTTPS is enforced via cert-manager and Let&rsquo;s Encrypt</li><li>WireGuard provides secure remote access to the network</li><li>Resources are isolated using namespaces</li></ul><h2 id=resource-requirements>Resource Requirements<a hidden class=anchor aria-hidden=true href=#resource-requirements>#</a></h2><p>The entire setup requires approximately:</p><ul><li>2-4 CPU cores</li><li>4-8 GB RAM</li><li>50+ GB storage space</li></ul><p>Individual service requirements are defined in the deployment manifests with resource limits.</p><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><ul><li>K3s: <a href=https://k3s.io/>https://k3s.io/</a></li><li>ArgoCD: <a href=https://argo-cd.readthedocs.io/>https://argo-cd.readthedocs.io/</a></li><li>Kustomize: <a href=https://kustomize.io/>https://kustomize.io/</a></li><li>Home Assistant: <a href=https://www.home-assistant.io/>https://www.home-assistant.io/</a></li><li>ESPHome: <a href=https://esphome.io/>https://esphome.io/</a></li><li>Pi-hole: <a href=https://pi-hole.net/>https://pi-hole.net/</a></li><li>WireGuard: <a href=https://www.wireguard.com/>https://www.wireguard.com/</a></li><li>Cert-Manager: <a href=https://cert-manager.io/>https://cert-manager.io/</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://nicolatomassoni.it/tags/kubernetes/>Kubernetes</a></li><li><a href=https://nicolatomassoni.it/tags/k3s/>K3s</a></li><li><a href=https://nicolatomassoni.it/tags/home-assistant/>Home-Assistant</a></li><li><a href=https://nicolatomassoni.it/tags/esphome/>Esphome</a></li><li><a href=https://nicolatomassoni.it/tags/pihole/>Pihole</a></li><li><a href=https://nicolatomassoni.it/tags/wireguard/>Wireguard</a></li><li><a href=https://nicolatomassoni.it/tags/gitops/>Gitops</a></li><li><a href=https://nicolatomassoni.it/tags/argocd/>Argocd</a></li><li><a href=https://nicolatomassoni.it/tags/homelab/>Homelab</a></li><li><a href=https://nicolatomassoni.it/tags/home-automation/>Home-Automation</a></li><li><a href=https://nicolatomassoni.it/tags/self-hosted/>Self-Hosted</a></li></ul><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Building an Home Automation Kubernetes Infrastructure with Home Assistant on x" href="https://x.com/intent/tweet/?text=Building%20an%20Home%20Automation%20Kubernetes%20Infrastructure%20with%20Home%20Assistant&amp;url=https%3a%2f%2fnicolatomassoni.it%2fposts%2ffirstpost%2f&amp;hashtags=kubernetes%2ck3s%2chome-assistant%2cesphome%2cpihole%2cwireguard%2cgitops%2cargocd%2chomelab%2chome-automation%2cself-hosted"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Building an Home Automation Kubernetes Infrastructure with Home Assistant on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fnicolatomassoni.it%2fposts%2ffirstpost%2f&amp;title=Building%20an%20Home%20Automation%20Kubernetes%20Infrastructure%20with%20Home%20Assistant&amp;summary=Building%20an%20Home%20Automation%20Kubernetes%20Infrastructure%20with%20Home%20Assistant&amp;source=https%3a%2f%2fnicolatomassoni.it%2fposts%2ffirstpost%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Building an Home Automation Kubernetes Infrastructure with Home Assistant on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fnicolatomassoni.it%2fposts%2ffirstpost%2f&title=Building%20an%20Home%20Automation%20Kubernetes%20Infrastructure%20with%20Home%20Assistant"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Building an Home Automation Kubernetes Infrastructure with Home Assistant on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fnicolatomassoni.it%2fposts%2ffirstpost%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Building an Home Automation Kubernetes Infrastructure with Home Assistant on whatsapp" href="https://api.whatsapp.com/send?text=Building%20an%20Home%20Automation%20Kubernetes%20Infrastructure%20with%20Home%20Assistant%20-%20https%3a%2f%2fnicolatomassoni.it%2fposts%2ffirstpost%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Building an Home Automation Kubernetes Infrastructure with Home Assistant on telegram" href="https://telegram.me/share/url?text=Building%20an%20Home%20Automation%20Kubernetes%20Infrastructure%20with%20Home%20Assistant&amp;url=https%3a%2f%2fnicolatomassoni.it%2fposts%2ffirstpost%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Building an Home Automation Kubernetes Infrastructure with Home Assistant on ycombinator" href="https://news.ycombinator.com/submitlink?t=Building%20an%20Home%20Automation%20Kubernetes%20Infrastructure%20with%20Home%20Assistant&u=https%3a%2f%2fnicolatomassoni.it%2fposts%2ffirstpost%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://nicolatomassoni.it/>Nicola Tomassoni</a></span> ·
<span>Thanks to
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
    <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span><a href=https://www.iubenda.com/privacy-policy/28830916 class="iubenda-black iubenda-noiframe iubenda-embed iubenda-noiframe" title="Privacy Policy ">Privacy Policy</a><script type=text/javascript>(function(e,t){var n=function(){var e=t.createElement("script"),n=t.getElementsByTagName("script")[0];e.src="https://cdn.iubenda.com/iubenda.js",n.parentNode.insertBefore(e,n)};e.addEventListener?e.addEventListener("load",n,!1):e.attachEvent?e.attachEvent("onload",n):e.onload=n})(window,document)</script>
<a href=https://www.iubenda.com/privacy-policy/28830916/cookie-policy class="iubenda-black iubenda-noiframe iubenda-embed iubenda-noiframe" title="Cookie Policy ">Cookie Policy</a><script type=text/javascript>(function(e,t){var n=function(){var e=t.createElement("script"),n=t.getElementsByTagName("script")[0];e.src="https://cdn.iubenda.com/iubenda.js",n.parentNode.insertBefore(e,n)};e.addEventListener?e.addEventListener("load",n,!1):e.attachEvent?e.attachEvent("onload",n):e.onload=n})(window,document)</script></footer><script type=text/javascript>var _iub=_iub||[];_iub.csConfiguration={askConsentAtCookiePolicyUpdate:!0,enableLgpd:!0,enableUspr:!0,floatingPreferencesButtonDisplay:"bottom-right",perPurposeConsent:!0,preferenceCookie:{expireAfter:180},siteId:3149869,usprApplies:!0,whitelabel:!1,cookiePolicyId:28830916,lang:"it",banner:{acceptButtonDisplay:!0,backgroundOverlay:!0,closeButtonDisplay:!1,customizeButtonDisplay:!0,explicitWithdrawal:!0,listPurposes:!0,ownerName:"Nicola Tomassoni",position:"bottom",rejectButtonDisplay:!0,showPurposesToggles:!0,showTotalNumberOfProviders:!0}}</script><script type=text/javascript src=//cs.iubenda.com/sync/3149869.js></script><script type=text/javascript src=//cdn.iubenda.com/cs/gpp/stub.js></script><script type=text/javascript src=//cdn.iubenda.com/cs/iubenda_cs.js async></script><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>